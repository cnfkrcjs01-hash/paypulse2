<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PayPulse ë°ì´í„° ê´€ë¦¬</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #f8f9fa;
            line-height: 1.6;
        }

        /* í—¤ë” */
        .pdm-header {
            background: linear-gradient(135deg, #FF5722 0%, #FF8A65 100%);
            color: white;
            padding: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-content h1 {
            margin: 0 0 0.5rem 0;
            font-size: 1.8rem;
            font-weight: 700;
        }

        .header-content p {
            margin: 0;
            opacity: 0.9;
        }

        .header-stats {
            display: flex;
            gap: 2rem;
        }

        .stat-item {
            text-align: right;
        }

        .stat-label {
            display: block;
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .stat-value {
            display: block;
            font-size: 1.4rem;
            font-weight: 600;
        }

        /* ë„¤ë¹„ê²Œì´ì…˜ */
        .pdm-navigation {
            background: white;
            padding: 0 2rem;
            display: flex;
            gap: 1rem;
            border-bottom: 1px solid #e0e0e0;
        }

        .nav-btn {
            background: none;
            border: none;
            padding: 1rem 1.5rem;
            cursor: pointer;
            font-size: 0.95rem;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
        }

        .nav-btn:hover {
            color: #FF5722;
            background: #f5f5f5;
        }

        .nav-btn.active {
            color: #FF5722;
            border-bottom-color: #FF5722;
            font-weight: 600;
        }

        /* ë©”ì¸ ì»¨í…ì¸  */
        .pdm-content {
            padding: 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .view-container {
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ëŒ€ì‹œë³´ë“œ */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .dashboard-card {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }

        .dashboard-card:hover {
            transform: translateY(-2px);
        }

        .dashboard-card h3 {
            margin: 0 0 1rem 0;
            color: #333;
            font-size: 1rem;
        }

        .file-count {
            font-size: 2rem;
            font-weight: 700;
            color: #FF5722;
            margin-bottom: 0.5rem;
        }

        .file-types {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
            font-size: 0.9rem;
            color: #666;
        }

        .data-overview {
            text-align: center;
            color: #666;
        }

        .data-note {
            font-size: 0.8rem;
            color: #FF5722;
            font-weight: 500;
            margin-top: 0.5rem;
        }

        .quick-upload {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }

        .quick-upload-btn {
            background: #FF5722;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.2s;
        }

        .quick-upload-btn:hover {
            background: #E64A19;
        }

        .analysis-info {
            text-align: center;
            color: #666;
        }

        .analysis-btn {
            background: #2196F3;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85rem;
            margin-top: 0.5rem;
        }

        .analysis-btn:hover {
            background: #1976D2;
        }

        /* ì—…ë¡œë“œ ë·° */
        .upload-container {
            max-width: 600px;
            margin: 0 auto;
        }

        .upload-container h2 {
            text-align: center;
            margin-bottom: 2rem;
            color: #333;
        }

        .upload-zone {
            border: 3px dashed #ddd;
            border-radius: 12px;
            padding: 3rem;
            text-align: center;
            background: white;
            transition: all 0.2s;
            margin-bottom: 2rem;
            position: relative;
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .upload-zone:hover, .upload-zone.drag-over {
            border-color: #FF5722;
            background: #fef7f5;
        }

        .upload-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .upload-zone h3 {
            margin: 0 0 0.5rem 0;
            color: #333;
        }

        .upload-zone p {
            color: #666;
            margin-bottom: 1.5rem;
        }

        .upload-btn {
            background: #FF5722;
            color: white;
            border: none;
            padding: 0.75rem 2rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: background 0.2s;
        }

        .upload-btn:hover {
            background: #E64A19;
        }

        .uploading {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #FF5722;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .upload-guide {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .upload-guide h4 {
            margin: 0 0 1rem 0;
            color: #FF5722;
        }

        .upload-guide ul {
            margin: 0;
            padding-left: 1.5rem;
            color: #555;
            line-height: 1.6;
        }

        /* íˆìŠ¤í† ë¦¬ */
        .empty-state {
            text-align: center;
            padding: 3rem;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .files-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .file-item {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .file-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.5rem;
        }

        .file-type-badge {
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .file-type-badge.template {
            background: #e3f2fd;
            color: #1976d2;
        }

        .file-type-badge.payroll {
            background: #f3e5f5;
            color: #7b1fa2;
        }

        .file-type-badge.other {
            background: #f5f5f5;
            color: #666;
        }

        .file-header h4 {
            margin: 0;
            color: #333;
        }

        .file-details {
            display: flex;
            gap: 1rem;
            font-size: 0.85rem;
            color: #666;
        }

        .file-actions {
            display: flex;
            gap: 0.5rem;
        }

        .view-btn {
            background: #FF5722;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85rem;
        }

        .delete-btn {
            background: #f44336;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85rem;
        }

        /* ìµœê·¼ íŒŒì¼ */
        .recent-files {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .recent-files h3 {
            margin: 0 0 1rem 0;
        }

        .recent-files-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .recent-file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            background: #f8f9fa;
            border-radius: 6px;
        }

        .file-info {
            display: flex;
            flex-direction: column;
        }

        .file-name {
            font-weight: 500;
            margin-bottom: 0.25rem;
        }

        .file-date {
            font-size: 0.85rem;
            color: #666;
        }

        /* ì•Œë¦¼ */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1rem 1.5rem;
            border-radius: 6px;
            color: white;
            font-weight: 500;
            transform: translateX(100%);
            transition: transform 0.3s;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: #4caf50;
        }

        .notification.error {
            background: #f44336;
        }

        .notification.info {
            background: #2196f3;
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .pdm-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }

            .header-stats {
                align-self: stretch;
                justify-content: space-between;
            }

            .pdm-navigation {
                overflow-x: auto;
                white-space: nowrap;
            }

            .pdm-content {
                padding: 1rem;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .file-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }

            .file-actions {
                align-self: stretch;
                justify-content: flex-end;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- í—¤ë” -->
        <header class="pdm-header">
            <div class="header-content">
                <h1>ğŸ“Š PayPulse ë°ì´í„° ê´€ë¦¬</h1>
                <p>ìŠ¤ë§ˆíŠ¸í•œ ê¸‰ì—¬ ë°ì´í„° ê´€ë¦¬ ì‹œìŠ¤í…œ</p>
            </div>
            <div class="header-stats">
                <div class="stat-item">
                    <span class="stat-label">ì—…ë¡œë“œëœ íŒŒì¼</span>
                    <span class="stat-value" id="fileCountHeader">0ê°œ</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">ìµœê·¼ ì—…ë¡œë“œ</span>
                    <span class="stat-value" id="lastUploadDate">-</span>
                </div>
            </div>
        </header>

        <!-- ë„¤ë¹„ê²Œì´ì…˜ -->
        <nav class="pdm-navigation">
            <button class="nav-btn active" data-view="dashboard">ğŸ  ëŒ€ì‹œë³´ë“œ</button>
            <button class="nav-btn" data-view="upload">ğŸ“¤ ì—…ë¡œë“œ</button>
            <button class="nav-btn" data-view="history">ğŸ“‹ íˆìŠ¤í† ë¦¬</button>
            <button class="nav-btn" data-view="preview" id="previewBtn" style="display: none;">ğŸ‘ï¸ ë¯¸ë¦¬ë³´ê¸°</button>
        </nav>

        <!-- ë©”ì¸ ì»¨í…ì¸  -->
        <main class="pdm-content">
            <!-- ëŒ€ì‹œë³´ë“œ ë·° -->
            <div id="dashboardView" class="view-container">
                <div class="dashboard-grid">
                    <div class="dashboard-card">
                        <h3>ğŸ“ ì—…ë¡œë“œëœ íŒŒì¼</h3>
                        <div class="file-count" id="fileCount">0ê°œ</div>
                        <div class="file-types">
                            <span>í…œí”Œë¦¿: <span id="templateCount">0</span></span>
                            <span>ê¸‰ì—¬ëŒ€ì¥: <span id="payrollCount">0</span></span>
                        </div>
                    </div>
                    
                    <div class="dashboard-card">
                        <h3>ğŸ“Š ë°ì´í„° í˜„í™©</h3>
                        <div class="data-overview">
                            <div>ê°œë³„ íŒŒì¼ë³„ë¡œ</div>
                            <div>ë°ì´í„°ë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤</div>
                            <div class="data-note">ëˆ„ì  ê³„ì‚°í•˜ì§€ ì•ŠìŒ</div>
                        </div>
                    </div>

                    <div class="dashboard-card quick-upload">
                        <h3>âš¡ ë¹ ë¥¸ ì—…ë¡œë“œ</h3>
                        <button class="quick-upload-btn" id="quickUploadBtn">
                            ìƒˆ íŒŒì¼ ì—…ë¡œë“œ
                        </button>
                    </div>

                    <div class="dashboard-card">
                        <h3>ğŸ” ë°ì´í„° ë¶„ì„</h3>
                        <div class="analysis-info">
                            <div>ê° íŒŒì¼ì„ ê°œë³„ì ìœ¼ë¡œ</div>
                            <div>ë¯¸ë¦¬ë³´ê¸°ì—ì„œ í™•ì¸í•˜ì„¸ìš”</div>
                            <button class="analysis-btn" id="analysisBtn">
                                íŒŒì¼ ëª©ë¡ ë³´ê¸°
                            </button>
                        </div>
                    </div>
                </div>

                <div class="recent-files" id="recentFiles" style="display: none;">
                    <h3>ìµœê·¼ ì—…ë¡œë“œëœ íŒŒì¼</h3>
                    <div class="recent-files-list" id="recentFilesList"></div>
                </div>
            </div>

            <!-- ì—…ë¡œë“œ ë·° -->
            <div id="uploadView" class="view-container" style="display: none;">
                <div class="upload-container">
                    <h2>ğŸ“¤ íŒŒì¼ ì—…ë¡œë“œ</h2>
                    
                    <div class="upload-zone" id="uploadZone">
                        <div class="upload-content">
                            <div class="upload-icon">ğŸ“</div>
                            <h3>íŒŒì¼ì„ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì—…ë¡œë“œ</h3>
                            <p>Excel (.xlsx, .xls), CSV íŒŒì¼ì„ ì§€ì›í•©ë‹ˆë‹¤</p>
                            <button class="upload-btn" id="selectFileBtn">íŒŒì¼ ì„ íƒ</button>
                        </div>
                        <div class="uploading" id="uploadingIndicator" style="display: none;">
                            <div class="spinner"></div>
                            <p>ì—…ë¡œë“œ ì¤‘...</p>
                        </div>
                    </div>

                    <!-- ìˆ¨ê²¨ì§„ íŒŒì¼ ì…ë ¥ -->
                    <input type="file" id="fileInput" accept=".xlsx,.xls,.csv" style="display: none;">

                    <div class="upload-guide">
                        <h4>ğŸ“‹ ì—…ë¡œë“œ ê°€ì´ë“œ</h4>
                        <ul>
                            <li>Excel íŒŒì¼(.xlsx, .xls) ë˜ëŠ” CSV íŒŒì¼ì„ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</li>
                            <li>íŒŒì¼ëª…ì— "í…œí”Œë¦¿"ì´ í¬í•¨ë˜ë©´ í…œí”Œë¦¿ìœ¼ë¡œ ìë™ ë¶„ë¥˜ë©ë‹ˆë‹¤</li>
                            <li>íŒŒì¼ëª…ì— "ê¸‰ì—¬"ê°€ í¬í•¨ë˜ë©´ ê¸‰ì—¬ëŒ€ì¥ìœ¼ë¡œ ìë™ ë¶„ë¥˜ë©ë‹ˆë‹¤</li>
                            <li>ì—…ë¡œë“œëœ íŒŒì¼ì€ ì¦‰ì‹œ ë¯¸ë¦¬ë³´ê¸°ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- íˆìŠ¤í† ë¦¬ ë·° -->
            <div id="historyView" class="view-container" style="display: none;">
                <h2>ğŸ“‹ ì—…ë¡œë“œ íˆìŠ¤í† ë¦¬</h2>
                
                <div class="empty-state" id="emptyState">
                    <p>ì•„ì§ ì—…ë¡œë“œëœ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                    <button class="upload-btn" id="emptyUploadBtn">
                        ì²« ë²ˆì§¸ íŒŒì¼ ì—…ë¡œë“œí•˜ê¸°
                    </button>
                </div>

                <div class="files-list" id="filesList" style="display: none;"></div>
            </div>

            <!-- ë¯¸ë¦¬ë³´ê¸° ë·° -->
            <div id="previewView" class="view-container" style="display: none;">
                <div class="preview-header">
                    <h2 id="previewTitle">ğŸ‘ï¸ íŒŒì¼ ë¯¸ë¦¬ë³´ê¸°</h2>
                    <div class="preview-info" id="previewInfo"></div>
                </div>

                <div class="preview-content" id="previewContent"></div>

                <div class="preview-actions">
                    <button class="delete-btn" id="deleteCurrentBtn">
                        ğŸ—‘ï¸ íŒŒì¼ ì‚­ì œ
                    </button>
                    <button class="view-btn" id="exportBtn">
                        ğŸ“Š PayPulse ì—°ë™
                    </button>
                </div>
            </div>
        </main>
    </div>

    <script>
        // PayPulse ë°ì´í„° ê´€ë¦¬ì
        class PayPulseDataManager {
            constructor() {
                this.uploadedFiles = [];
                this.currentView = 'dashboard';
                this.selectedFile = null;
                
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.loadSavedData();
                this.updateUI();
            }

            setupEventListeners() {
                // ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼
                document.querySelectorAll('.nav-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const view = e.target.getAttribute('data-view');
                        this.switchView(view);
                    });
                });

                // ì—…ë¡œë“œ ê´€ë ¨ ë²„íŠ¼ë“¤
                document.getElementById('quickUploadBtn').addEventListener('click', () => {
                    this.switchView('upload');
                });

                document.getElementById('selectFileBtn').addEventListener('click', () => {
                    this.selectFile();
                });

                document.getElementById('emptyUploadBtn').addEventListener('click', () => {
                    this.switchView('upload');
                });

                document.getElementById('analysisBtn').addEventListener('click', () => {
                    this.switchView('history');
                });

                // íŒŒì¼ ì…ë ¥
                const fileInput = document.getElementById('fileInput');
                fileInput.addEventListener('change', (e) => {
                    if (e.target.files.length > 0) {
                        this.handleFileUpload(e.target.files[0]);
                    }
                });

                // ë“œë˜ê·¸ ì•¤ ë“œë¡­
                const uploadZone = document.getElementById('uploadZone');
                uploadZone.addEventListener('click', () => {
                    this.selectFile();
                });

                uploadZone.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    uploadZone.classList.add('drag-over');
                });

                uploadZone.addEventListener('dragleave', (e) => {
                    e.preventDefault();
                    uploadZone.classList.remove('drag-over');
                });

                uploadZone.addEventListener('drop', (e) => {
                    e.preventDefault();
                    uploadZone.classList.remove('drag-over');
                    
                    const files = Array.from(e.dataTransfer.files);
                    const excelFile = files.find(f => 
                        f.name.endsWith('.xlsx') || f.name.endsWith('.xls') || f.name.endsWith('.csv')
                    );
                    
                    if (excelFile) {
                        this.handleFileUpload(excelFile);
                    }
                });

                // ë¯¸ë¦¬ë³´ê¸° ì•¡ì…˜ ë²„íŠ¼ë“¤
                document.getElementById('deleteCurrentBtn').addEventListener('click', () => {
                    this.deleteCurrentFile();
                });

                document.getElementById('exportBtn').addEventListener('click', () => {
                    this.exportToPayPulse();
                });
            }

            // ë·° ì „í™˜
            switchView(viewName) {
                // ëª¨ë“  ë·° ìˆ¨ê¸°ê¸°
                document.querySelectorAll('.view-container').forEach(view => {
                    view.style.display = 'none';
                });

                // ëª¨ë“  ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ ë¹„í™œì„±í™”
                document.querySelectorAll('.nav-btn').forEach(btn => {
                    btn.classList.remove('active');
                });

                // ì„ íƒëœ ë·° í‘œì‹œ
                const targetView = document.getElementById(viewName + 'View');
                if (targetView) {
                    targetView.style.display = 'block';
                }

                // ì„ íƒëœ ë²„íŠ¼ í™œì„±í™”
                const targetBtn = document.querySelector(`[data-view="${viewName}"]`);
                if (targetBtn) {
                    targetBtn.classList.add('active');
                }

                this.currentView = viewName;
            }

            // íŒŒì¼ ì„ íƒ
            selectFile() {
                const fileInput = document.getElementById('fileInput');
                fileInput.click();
            }

            // íŒŒì¼ ì—…ë¡œë“œ ì²˜ë¦¬
            async handleFileUpload(file) {
                const indicator = document.getElementById('uploadingIndicator');
                const content = document.querySelector('.upload-content');
                
                // ì—…ë¡œë“œ í‘œì‹œ
                indicator.style.display = 'block';
                content.style.display = 'none';

                try {
                    // XLSX ë¼ì´ë¸ŒëŸ¬ë¦¬ í™•ì¸
                    if (typeof XLSX === 'undefined') {
                        throw new Error('XLSX ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                    }

                    const arrayBuffer = await file.arrayBuffer();
                    const workbook = XLSX.read(arrayBuffer, { type: 'array' });
                    
                    const sheets = {};
                    const allData = [];
                    
                    workbook.SheetNames.forEach(sheetName => {
                        const worksheet = workbook.Sheets[sheetName];
                        const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                        sheets[sheetName] = jsonData;
                        allData.push(...jsonData);
                    });

                    // íŒŒì¼ íƒ€ì… ìë™ ê°ì§€
                    let fileType = 'other';
                    if (file.name.includes('í…œí”Œë¦¿') || file.name.includes('template')) {
                        fileType = 'template';
                    } else if (file.name.includes('ê¸‰ì—¬') || file.name.includes('payroll') || file.name.includes('ë”ë¯¸')) {
                        fileType = 'payroll';
                    }

                    const uploadedFile = {
                        id: Date.now().toString(),
                        name: file.name,
                        size: file.size,
                        uploadDate: new Date(),
                        data: allData,
                        sheets: sheets,
                        type: fileType
                    };

                    this.uploadedFiles.push(uploadedFile);
                    this.selectedFile = uploadedFile;
                    
                    // ë°ì´í„° ì €ì¥
                    this.saveData();
                    this.updateUI();
                    
                    // ë¯¸ë¦¬ë³´ê¸°ë¡œ ìë™ ì´ë™
                    document.getElementById('previewBtn').style.display = 'inline-block';
                    this.switchView('preview');
                    this.showPreview(uploadedFile);

                    this.showNotification('íŒŒì¼ì´ ì„±ê³µì ìœ¼ë¡œ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ‰', 'success');

                } catch (error) {
                    console.error('File upload error:', error);
                    this.showNotification('íŒŒì¼ ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error');
                } finally {
                    // ì—…ë¡œë“œ í‘œì‹œ ìˆ¨ê¸°ê¸°
                    indicator.style.display = 'none';
                    content.style.display = 'block';
                }
            }

            // UI ì—…ë°ì´íŠ¸
            updateUI() {
                // í—¤ë”
                document.getElementById('fileCountHeader').textContent = this.uploadedFiles.length + 'ê°œ';
                
                const lastUploadDate = this.uploadedFiles.length > 0 ? 
                    this.uploadedFiles[this.uploadedFiles.length - 1].uploadDate.toLocaleDateString() : '-';
                document.getElementById('lastUploadDate').textContent = lastUploadDate;

                // ëŒ€ì‹œë³´ë“œ
                document.getElementById('fileCount').textContent = this.uploadedFiles.length + 'ê°œ';
                document.getElementById('templateCount').textContent = this.uploadedFiles.filter(f => f.type === 'template').length;
                document.getElementById('payrollCount').textContent = this.uploadedFiles.filter(f => f.type === 'payroll').length;

                this.updateRecentFiles();
                this.updateHistory();
            }

            // ìµœê·¼ íŒŒì¼ ì—…ë°ì´íŠ¸
            updateRecentFiles() {
                const recentFiles = document.getElementById('recentFiles');
                const recentFilesList = document.getElementById('recentFilesList');

                if (this.uploadedFiles.length === 0) {
                    recentFiles.style.display = 'none';
                    return;
                }

                recentFiles.style.display = 'block';
                recentFilesList.innerHTML = '';

                this.uploadedFiles.slice(-3).forEach(file => {
                    const fileItem = document.createElement('div');
                    fileItem.className = 'recent-file-item';
                    fileItem.innerHTML = `
                        <div class="file-info">
                            <span class="file-name">${file.name}</span>
                            <span class="file-date">${file.uploadDate.toLocaleDateString()}</span>
                        </div>
                        <button class="view-btn">ë³´ê¸°</button>
                    `;
                    
                    fileItem.querySelector('.view-btn').addEventListener('click', () => {
                        this.viewFile(file.id);
                    });
                    
                    recentFilesList.appendChild(fileItem);
                });
            }

            // íˆìŠ¤í† ë¦¬ ì—…ë°ì´íŠ¸
            updateHistory() {
                const emptyState = document.getElementById('emptyState');
                const filesList = document.getElementById('filesList');

                if (this.uploadedFiles.length === 0) {
                    emptyState.style.display = 'block';
                    filesList.style.display = 'none';
                    return;
                }

                emptyState.style.display = 'none';
                filesList.style.display = 'block';
                filesList.innerHTML = '';

                this.uploadedFiles.forEach(file => {
                    const fileItem = document.createElement('div');
                    fileItem.className = 'file-item';
                    
                    const typeText = file.type === 'template' ? 'í…œí”Œë¦¿' : 
                                   file.type === 'payroll' ? 'ê¸‰ì—¬ëŒ€ì¥' : 'ê¸°íƒ€';

                    fileItem.innerHTML = `
                        <div class="file-info">
                            <div class="file-header">
                                <span class="file-type-badge ${file.type}">${typeText}</span>
                                <h4>${file.name}</h4>
                            </div>
                            <div class="file-details">
                                <span>í¬ê¸°: ${(file.size / 1024).toFixed(1)} KB</span>
                                <span>ì—…ë¡œë“œ: ${file.uploadDate.toLocaleString()}</span>
                                <span>ì‹œíŠ¸: ${Object.keys(file.sheets).length}ê°œ</span>
                            </div>
                        </div>
                        <div class="file-actions">
                            <button class="view-btn">ë¯¸ë¦¬ë³´ê¸°</button>
                            <button class="delete-btn">ì‚­ì œ</button>
                        </div>
                    `;
                    
                    fileItem.querySelector('.view-btn').addEventListener('click', () => {
                        this.viewFile(file.id);
                    });
                    
                    fileItem.querySelector('.delete-btn').addEventListener('click', () => {
                        this.confirmDelete(file.id);
                    });
                    
                    filesList.appendChild(fileItem);
                });
            }

            // íŒŒì¼ ë³´ê¸°
            viewFile(fileId) {
                const file = this.uploadedFiles.find(f => f.id === fileId);
                if (file) {
                    this.selectedFile = file;
                    document.getElementById('previewBtn').style.display = 'inline-block';
                    this.switchView('preview');
                    this.showPreview(file);
                }
            }

            // ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ
            showPreview(file) {
                const title = document.getElementById('previewTitle');
                const info = document.getElementById('previewInfo');
                const content = document.getElementById('previewContent');

                title.textContent = `ğŸ‘ï¸ ${file.name}`;
                
                const typeText = file.type === 'template' ? 'í…œí”Œë¦¿' : 
                                file.type === 'payroll' ? 'ê¸‰ì—¬ëŒ€ì¥' : 'ê¸°íƒ€';

                info.innerHTML = `
                    <span>ì—…ë¡œë“œ: ${file.uploadDate.toLocaleString()}</span>
                    <span>í¬ê¸°: ${(file.size / 1024).toFixed(1)} KB</span>
                    <span class="file-type-badge ${file.type}">${typeText}</span>
                `;

                content.innerHTML = '';

                Object.keys(file.sheets).forEach(sheetName => {
                    const sheetDiv = document.createElement('div');
                    sheetDiv.className = 'sheet-preview';

                    const sheetData = file.sheets[sheetName];
                    const maxRows = Math.min(25, sheetData.length); // 25í–‰ê¹Œì§€ í‘œì‹œ

                    let tableHTML = `
                        <h3 style="margin: 0; padding: 1rem; background: #f8f9fa; border-bottom: 1px solid #e0e0e0;">ğŸ“„ ${sheetName}</h3>
                        <div style="overflow: auto; max-height: 500px;">
                            <table style="width: 100%; border-collapse: collapse; font-size: 0.85rem;">
                                <tbody>
                    `;

                    for (let i = 0; i < maxRows; i++) {
                        const row = sheetData[i] || [];
                        const rowClass = i === 0 ? 'style="background: #f8f9fa; font-weight: 600;"' : '';
                        tableHTML += `<tr ${rowClass}>`;
                        
                        const maxCols = Math.min(10, row.length);
                        for (let j = 0; j < maxCols; j++) {
                            const cell = row[j] !== null && row[j] !== undefined ? String(row[j]) : '';
                            tableHTML += `<td style="padding: 0.5rem; border-bottom: 1px solid #f0f0f0; white-space: nowrap;">${cell}</td>`;
                        }
                        tableHTML += '</tr>';
                    }

                    tableHTML += `
                                </tbody>
                            </table>
                        </div>
                    `;

                    if (sheetData.length > maxRows) {
                        tableHTML += `<p style="padding: 1rem; text-align: center; color: #666; margin: 0;">... ì™¸ ${sheetData.length - maxRows}í–‰ ë” ìˆìŠµë‹ˆë‹¤ (ì´ ${sheetData.length}í–‰)</p>`;
                    }

                    sheetDiv.innerHTML = tableHTML;
                    sheetDiv.style.cssText = 'background: white; margin-bottom: 2rem; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 4px rgba(0,0,0,0.1);';
                    content.appendChild(sheetDiv);
                });
            }

            // íŒŒì¼ ì‚­ì œ í™•ì¸
            confirmDelete(fileId) {
                const file = this.uploadedFiles.find(f => f.id === fileId);
                if (file && confirm(`${file.name}ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                    this.deleteFile(fileId);
                }
            }

            // í˜„ì¬ íŒŒì¼ ì‚­ì œ
            deleteCurrentFile() {
                if (this.selectedFile && confirm(`${this.selectedFile.name}ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                    this.deleteFile(this.selectedFile.id);
                }
            }

            // íŒŒì¼ ì‚­ì œ
            deleteFile(fileId) {
                this.uploadedFiles = this.uploadedFiles.filter(f => f.id !== fileId);
                
                if (this.selectedFile && this.selectedFile.id === fileId) {
                    this.selectedFile = null;
                    document.getElementById('previewBtn').style.display = 'none';
                    this.switchView('dashboard');
                }

                this.saveData();
                this.updateUI();
                this.showNotification('íŒŒì¼ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
            }

            // PayPulse ì—°ë™
            exportToPayPulse() {
                if (!this.selectedFile) return;

                const exportData = {
                    fileName: this.selectedFile.name,
                    type: this.selectedFile.type,
                    sheets: this.selectedFile.sheets,
                    uploadDate: this.selectedFile.uploadDate
                };

                const paypulseData = JSON.parse(localStorage.getItem('paypulse_integrated_data') || '[]');
                paypulseData.push({
                    ...exportData,
                    exportDate: new Date(),
                    status: 'integrated'
                });
                localStorage.setItem('paypulse_integrated_data', JSON.stringify(paypulseData));

                this.showNotification('ë°ì´í„°ê°€ PayPulse ì‹œìŠ¤í…œì— ì—°ë™ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸš€', 'success');
            }

            // ì•Œë¦¼ í‘œì‹œ
            showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.textContent = message;
                
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.classList.add('show');
                }, 100);

                setTimeout(() => {
                    notification.classList.remove('show');
                    setTimeout(() => {
                        document.body.removeChild(notification);
                    }, 300);
                }, 3000);
            }

            // ë°ì´í„° ì €ì¥
            saveData() {
                try {
                    localStorage.setItem('paypulse_uploaded_files', JSON.stringify(this.uploadedFiles));
                } catch (error) {
                    console.error('ë°ì´í„° ì €ì¥ ì˜¤ë¥˜:', error);
                }
            }

            // ë°ì´í„° ë¡œë“œ
            loadSavedData() {
                try {
                    const savedFiles = localStorage.getItem('paypulse_uploaded_files');

                    if (savedFiles) {
                        this.uploadedFiles = JSON.parse(savedFiles).map(file => ({
                            ...file,
                            uploadDate: new Date(file.uploadDate)
                        }));
                    }

                    if (this.uploadedFiles.length > 0) {
                        document.getElementById('previewBtn').style.display = 'inline-block';
                    }
                } catch (error) {
                    console.error('ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
                    this.uploadedFiles = [];
                }
            }
        }

        // ì•± ì´ˆê¸°í™”
        let dataManager;
        document.addEventListener('DOMContentLoaded', function() {
            // XLSX ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ í™•ì¸
            if (typeof XLSX === 'undefined') {
                console.error('XLSX ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                alert('XLSX ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë”© ì‹¤íŒ¨. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
                return;
            }

            dataManager = new PayPulseDataManager();
            console.log('PayPulse ë°ì´í„° ê´€ë¦¬ì ì´ˆê¸°í™” ì™„ë£Œ');
        });
    </script>
</body>
</html>